import{j as e,r,I,J as G,c as p,F as D,u as Q,a as Z,b as A,t as W,K as T,L as C,H as V,N as H,P as J,Q as K}from"./index-1f2d8112.js";import{B as k}from"./Button-6f10587e.js";import{u as B}from"./user.service-cf7c70a2.js";import{s as X}from"./config-bc6444f8.js";import{u as Y,S as L}from"./Select-3229e15e.js";import{M as _}from"./MainScreen-bea2d245.js";import{E as j}from"./ErrMsg-e2ed7b40.js";import{u as ee}from"./index.esm-d663fa69.js";const te=({percentage:o,themeColor:t})=>{const s=`radial-gradient(closest-side,  rgb(71 85 99) 80%, transparent 81%),
  conic-gradient(${t} ${o>100?100:o}%, rgb(241 245 249) 0)`;return e("div",{className:"relative my-auto flex h-40 w-40 items-center justify-center",children:e("div",{className:"h-full w-full rounded-full",style:{background:s}})})};function q(o,t){var m;const s=(m=o.current)==null?void 0:m.getBoundingClientRect();if(!s)return;const a=window.innerHeight-s.top<t,c={top:s.bottom+s.height/2+window.scrollY},u={bottom:window.innerHeight-s.top+s.height/2};return{isModalAbove:a,position:{...a?u:c,left:s.left+s.width/2+window.scrollX},rect:s}}const E=r.createContext(void 0),v=({children:o,externalStateControl:t,onClose:s,onOpen:n,onAfterClose:a})=>{const[c,u]=r.useState(""),[m,f]=r.useState(null),[i,g]=r.useState(null),[l,b]=r.useState(!1),d=()=>{if(s==null||s(),t){t.setOpenedModalName(""),a==null||a();return}u(""),a==null||a()},w=P=>{if(n==null||n(),t){t.setOpenedModalName(P);return}u(P)},{debouncedFunc:x,cancel:N}=I(()=>{d()},500),U={openedModalName:(t==null?void 0:t.openedModalName)||c,close:d,open:w,position:m,setPosition:f,isModalAbove:l,setIsModalAbove:b,modalHoverGuardZone:i,setModalHoverGuardZone:g,debouncedClose:x,cancelDebouncedClose:N};return e(E.Provider,{value:U,children:o})},se=({children:o,modalName:t,className:s,setPositionByRef:n=!1,modalHeight:a=0,externalControlFunc:c})=>{const{open:u,setPosition:m,setIsModalAbove:f}=r.useContext(E),i=r.useRef(null),g=r.useCallback(()=>{const b=q(i,a),{isModalAbove:d,position:w}=b;f(d),m(w)},[a,f,m]),l=()=>{if(n&&g(),c)return c();u(t)};return r.useEffect(()=>{if(!n)return;const b=["wheel","scroll","resize"];return b.forEach(d=>{window.addEventListener(d,g)}),()=>{b.forEach(d=>{window.removeEventListener(d,g)})}},[n,g]),r.cloneElement(o,{onClick:l,ref:i,className:s})},ae=({children:o,onClickFn:t,className:s})=>{const{close:n}=r.useContext(E);return r.cloneElement(o,{onClick:()=>{t==null||t(),n()},className:s})},ne=({children:o,modalName:t,modalHeight:s=0})=>{const{open:n,setPosition:a,setIsModalAbove:c,setModalHoverGuardZone:u,debouncedClose:m,cancelDebouncedClose:f}=r.useContext(E),i=r.useRef(null),{debouncedFunc:g,cancel:l}=I(b,500);function b(){const x=q(i,s);x&&(a(x.position),c(x.isModalAbove),u({height:x.rect.height,width:x.rect.width}),n(t))}function d(){f(),g()}function w(){l(),m()}return e("div",{className:"modal-hover-open",ref:i,onMouseEnter:d,onMouseLeave:w,children:o})},oe=({children:o,name:t,className:s,elementId:n="root",style:a={},hoverControl:c=!1})=>{const{openedModalName:u,open:m,close:f,position:i,isModalAbove:g,modalHoverGuardZone:l,debouncedClose:b,cancelDebouncedClose:d}=r.useContext(E),{outsideClickRef:w}=Y(f);function x(){d(),m(t)}function N(){b()}return t!==u?null:G.createPortal(p(D,{children:[e(_,{onClickFn:f,darkMode:!0}),p("section",{className:s,style:{...a,...i},ref:w,onMouseEnter:()=>c&&x(),onMouseLeave:()=>c&&N(),"data-testid":"modal-window",children:[o,c&&l&&e("div",{className:"modal-hover-guard-zone",style:{top:g?"100%":`-${l.height/2}px`,height:`${l.height/2}px`||"10%",width:`${l.width}px`||"10%"}})]})]}),document.getElementById(n))};v.OpenBtn=se;v.Window=oe;v.CloseBtn=ae;v.ModalHoverOpen=ne;function O({answerCount:o,questionCount:t}){return o/t*100}const re=({answerLanguage:o,answerCount:t,questionCount:s,onRestart:n})=>{const[a,c]=r.useState("total"),[u,m]=r.useState(O({answerCount:t.total,questionCount:s.total})),{themeColor:f}=X.programmingLanguages[o].themeColors;function i(l){c(l),m(O({answerCount:t[l],questionCount:s[l]}))}async function g(){n({language:o,level:a==="total"?void 0:a})}return p("div",{className:"flex min-h-[26rem] w-72 flex-col items-center overflow-hidden rounded-md bg-gray-600 pt-4",children:[e(te,{percentage:u,themeColor:f}),p("h3",{className:"my-auto text-4xl font-medium md:text-3xl",children:[t[a],"/",s[a]]}),p(v,{children:[e(v.OpenBtn,{modalName:"restart",className:`my-auto flex h-12 w-44 \r
          cursor-pointer items-center justify-center rounded-xl border border-gray-800 bg-gray-700 text-2xl font-semibold capitalize leading-5 text-gray-100 outline-none transition-all duration-300`,children:e("span",{children:"restart"})}),p(v.Window,{name:"restart",className:"fixed left-1/2 top-1/2 z-[500] flex max-w-[320px] -translate-x-1/2 -translate-y-1/2 transform flex-col items-center rounded-lg bg-gray-600 p-8 text-gray-100 shadow-xl",children:[e("p",{className:"text-2xl font-semibold",children:"Are you sure you want to restart?"}),e("p",{className:"text-md mt-4 max-w-[200px] font-medium",children:"This will reset all your progress, and bring you questions you have already answered."}),p("div",{className:"mt-8 flex items-center gap-4",children:[e(v.CloseBtn,{className:"rounded-full bg-gray-800 px-5 py-3 text-lg font-medium uppercase",children:e("button",{children:"cancel"})}),e(v.CloseBtn,{className:"rounded-full bg-gray-800 px-5 py-3 text-lg font-medium uppercase",onClickFn:g,children:e("button",{children:"restart"})})]})]})]}),p(L,{onChange:i,children:[e(L.SelectTrigger,{className:`my-auto h-12 w-44 cursor-pointer rounded-xl \r
            border border-gray-800 bg-gray-700 text-2xl capitalize leading-5 outline-none transition-all duration-300`,children:e("button",{type:"button",children:a})}),e(L.SelectList,{className:`z-[1500] mt-1 w-44  min-w-[100px] cursor-pointer \r
            border-2  border-gray-800 bg-gray-700 text-2xl leading-5 outline-none transition-all duration-300`,children:Object.keys(t).map(l=>e(L.SelectItem,{value:l,className:`flex h-12 w-full min-w-[100px]  cursor-pointer items-center justify-center border-b-2 border-gray-800 bg-gray-700 text-2xl\r
                    text-gray-100 hover:border-gray-900 hover:bg-gray-950 hover:text-gray-100`,children:e("span",{className:"capitalize",children:l})},l))})]}),e("div",{className:"mt-auto flex h-14 w-full items-center justify-center bg-gray-900",children:e("span",{className:"text-[1.8rem] font-bold tracking-wide text-gray-100",children:o})})]})},pe=()=>{const o=Q(),t=Z(),s=A(),{loggedInUser:n}=W(),[a,c]=r.useState(null),[u,m]=r.useState(!1),[f,i]=r.useState(T),g=f.state==="succeeded"&&a&&!u,l=f.state==="loading",{id:b}=o,d=n&&n.id===b,{register:w,handleSubmit:x,formState:{errors:N}}=ee({});async function U(){try{i(y=>({...y,state:"loading"}));const h=await B.getUserStats();c(h),i(y=>({...y,state:"succeeded"}))}catch(h){const y=H(h);i(S=>({...S,state:"failed",error:y}))}}r.useEffect(()=>{!d||a||U()},[d,a]);function P(){s(J()),t("/home")}function z(){m(h=>!h)}async function R({language:h,level:y}){try{i(M=>({...M,state:"loading"})),await B.removeUserCorrectAnswers({language:h,level:y});const S=await B.getUserStats();c(S),i(M=>({...M,state:"succeeded"}))}catch(S){const M=H(S);i(F=>({...F,state:"failed",error:M}))}}function $(h){n&&(s(K({...n,...h})),m(!1))}return p("main",{className:"flex min-h-[250px] w-screen flex-col items-center overflow-hidden p-2 pb-24",children:[!d&&e(C,{className:"mt-52"}),d&&p("div",{className:"mt-5 flex w-full flex-col items-center gap-6 md:w-3/5",children:[p(V,{className:"flex w-full flex-col gap-4",children:[e("h1",{className:"text-4xl font-semibold tracking-wider",children:n.username}),p("div",{className:"flex items-center gap-3 self-start",children:[e(k,{onClickFn:P,className:"text-md transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",children:"logout"}),e(k,{onClickFn:z,className:"text-md transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",children:u?"stats":"edit"})]})]}),u&&p("form",{onSubmit:x($),className:"mt-10 flex flex-col items-center gap-4 rounded-xl bg-gray-600 p-6",children:[e("input",{...w("username",{required:"Username is required"}),placeholder:"Username",className:"text-md w-64 transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",defaultValue:n.username||""}),N.username&&e(j,{msg:N.username.message}),e("input",{...w("email",{required:"Email is required",pattern:{value:/\S+@\S+\.\S+/,message:"Entered value does not match email format"}}),placeholder:"Email",className:"text-md w-64 transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",defaultValue:n.email||""}),N.email&&e(j,{msg:N.email.message}),e(k,{type:"submit",className:"text-md mt-5 w-20 transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",children:"Save"})]}),p("ul",{className:"flex w-full flex-wrap justify-center gap-4 self-start",children:[l&&e(C,{className:"mt-10 self-center"}),g&&e(D,{children:Object.entries(a.answersCount).map(([h,y])=>e(re,{answerLanguage:h,answerCount:y,questionCount:a.questionsCount[h],onRestart:R},h))})]})]})]})};export{pe as default};
