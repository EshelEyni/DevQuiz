import{j as e,r as l,E as I,I as G,c as h,F as D,u as Z,a as A,b as Q,w as W,J as T,L as C,H as V,K as H,M as J,N as K}from"./index-f9e05c39.js";import{B as k,c as X}from"./Button-0c06efe1.js";import{u as B}from"./user.service-7063b179.js";import{s as Y}from"./config-bc6444f8.js";import{u as _,S as P}from"./Select-5a36b32f.js";import{M as ee}from"./MainScreen-3940b3b5.js";import{E as j}from"./ErrMsg-ce25a67c.js";import{u as te}from"./index.esm-8f109fbc.js";const se=({percentage:o,themeColor:t})=>{const s=`radial-gradient(closest-side,  rgb(71 85 99) 80%, transparent 81%),
  conic-gradient(${t} ${o>100?100:o}%, rgb(241 245 249) 0)`;return e("div",{className:"relative my-auto flex h-40 w-40 items-center justify-center",children:e("div",{className:"h-full w-full rounded-full",style:{background:s}})})};function q(o,t){var m;const s=(m=o.current)==null?void 0:m.getBoundingClientRect();if(!s)return;const a=window.innerHeight-s.top<t,c={top:s.bottom+s.height/2+window.scrollY},u={bottom:window.innerHeight-s.top+s.height/2};return{isModalAbove:a,position:{...a?u:c,left:s.left+s.width/2+window.scrollX},rect:s}}const E=l.createContext(void 0),v=({children:o,externalStateControl:t,onClose:s,onOpen:n,onAfterClose:a})=>{const[c,u]=l.useState(""),[m,f]=l.useState(null),[i,g]=l.useState(null),[r,b]=l.useState(!1),d=()=>{if(s==null||s(),t){t.setOpenedModalName(""),a==null||a();return}u(""),a==null||a()},w=L=>{if(n==null||n(),t){t.setOpenedModalName(L);return}u(L)},{debouncedFunc:x,cancel:N}=I(()=>{d()},500),U={openedModalName:(t==null?void 0:t.openedModalName)||c,close:d,open:w,position:m,setPosition:f,isModalAbove:r,setIsModalAbove:b,modalHoverGuardZone:i,setModalHoverGuardZone:g,debouncedClose:x,cancelDebouncedClose:N};return e(E.Provider,{value:U,children:o})},ae=({children:o,modalName:t,className:s,setPositionByRef:n=!1,modalHeight:a=0,externalControlFunc:c})=>{const{open:u,setPosition:m,setIsModalAbove:f}=l.useContext(E),i=l.useRef(null),g=l.useCallback(()=>{const b=q(i,a),{isModalAbove:d,position:w}=b;f(d),m(w)},[a,f,m]),r=()=>{if(n&&g(),c)return c();u(t)};return l.useEffect(()=>{if(!n)return;const b=["wheel","scroll","resize"];return b.forEach(d=>{window.addEventListener(d,g)}),()=>{b.forEach(d=>{window.removeEventListener(d,g)})}},[n,g]),l.cloneElement(o,{onClick:r,ref:i,className:s})},ne=({children:o,onClickFn:t,className:s})=>{const{close:n}=l.useContext(E);return l.cloneElement(o,{onClick:()=>{t==null||t(),n()},className:s})},oe=({children:o,modalName:t,modalHeight:s=0})=>{const{open:n,setPosition:a,setIsModalAbove:c,setModalHoverGuardZone:u,debouncedClose:m,cancelDebouncedClose:f}=l.useContext(E),i=l.useRef(null),{debouncedFunc:g,cancel:r}=I(b,500);function b(){const x=q(i,s);x&&(a(x.position),c(x.isModalAbove),u({height:x.rect.height,width:x.rect.width}),n(t))}function d(){f(),g()}function w(){r(),m()}return e("div",{className:"modal-hover-open",ref:i,onMouseEnter:d,onMouseLeave:w,children:o})},re=({children:o,name:t,className:s,elementId:n="root",style:a={},hoverControl:c=!1})=>{const{openedModalName:u,open:m,close:f,position:i,isModalAbove:g,modalHoverGuardZone:r,debouncedClose:b,cancelDebouncedClose:d}=l.useContext(E),{outsideClickRef:w}=_(f);function x(){d(),m(t)}function N(){b()}return t!==u?null:G.createPortal(h(D,{children:[e(ee,{onClickFn:f,darkMode:!0}),h("section",{className:s,style:{...a,...i},ref:w,onMouseEnter:()=>c&&x(),onMouseLeave:()=>c&&N(),"data-testid":"modal-window",children:[o,c&&r&&e("div",{className:"modal-hover-guard-zone",style:{top:g?"100%":`-${r.height/2}px`,height:`${r.height/2}px`||"10%",width:`${r.width}px`||"10%"}})]})]}),document.getElementById(n))};v.OpenBtn=ae;v.Window=re;v.CloseBtn=ne;v.ModalHoverOpen=oe;function O({answerCount:o,questionCount:t}){return o/t*100}const le=({answerLanguage:o,answerCount:t,questionCount:s,onRestart:n})=>{const[a,c]=l.useState("total"),[u,m]=l.useState(O({answerCount:t.total,questionCount:s.total})),{themeColor:f}=Y.programmingLanguages[o].themeColors;function i(r){c(r),m(O({answerCount:t[r],questionCount:s[r]}))}async function g(){n({language:o,level:a==="total"?void 0:a})}return h("div",{className:"flex min-h-[26rem] w-72 flex-col items-center overflow-hidden rounded-md bg-gray-600 pt-4",children:[e(se,{percentage:u,themeColor:f}),h("h3",{className:"my-auto text-4xl font-medium md:text-3xl",children:[t[a],"/",s[a]]}),h(v,{children:[e(v.OpenBtn,{modalName:"restart",className:`my-auto flex h-12 w-44 \r
          cursor-pointer items-center justify-center rounded-xl border border-gray-800 bg-gray-700 text-2xl font-semibold capitalize leading-5 text-gray-100 outline-none transition-all duration-300`,children:e("span",{children:"restart"})}),h(v.Window,{name:"restart",className:"fixed left-1/2 top-1/2 z-[500] flex max-w-[320px] -translate-x-1/2 -translate-y-1/2 transform flex-col items-center rounded-lg bg-gray-600 p-8 text-gray-100 shadow-xl",children:[e("p",{className:"text-2xl font-semibold",children:"Are you sure you want to restart?"}),e("p",{className:"text-md mt-4 max-w-[200px] font-medium",children:"This will reset all your progress, and bring you questions you have already answered."}),h("div",{className:"mt-8 flex items-center gap-4",children:[e(v.CloseBtn,{className:"rounded-full bg-gray-800 px-5 py-3 text-lg font-medium uppercase",children:e("button",{children:"cancel"})}),e(v.CloseBtn,{className:"rounded-full bg-gray-800 px-5 py-3 text-lg font-medium uppercase",onClickFn:g,children:e("button",{children:"restart"})})]})]})]}),h(P,{onChange:i,children:[e(P.SelectTrigger,{className:`my-auto h-12 w-44 cursor-pointer rounded-xl \r
            border border-gray-800 bg-gray-700 text-2xl capitalize leading-5 outline-none transition-all duration-300`,children:e("button",{type:"button",children:a})}),e(P.SelectList,{className:`z-[1500] mt-1 w-44  min-w-[100px] cursor-pointer \r
            border-2  border-gray-800 bg-gray-700 text-2xl leading-5 outline-none transition-all duration-300`,children:Object.keys(t).map(r=>e(P.SelectItem,{value:r,className:`flex h-12 w-full min-w-[100px]  cursor-pointer items-center justify-center border-b-2 border-gray-800 bg-gray-700 text-2xl\r
                    text-gray-100 hover:border-gray-900 hover:bg-gray-950 hover:text-gray-100`,children:e("span",{className:"capitalize",children:r})},r))})]}),e("div",{className:"mt-auto flex h-14 w-full items-center justify-center bg-gray-900",children:e("span",{className:"text-[1.8rem] font-bold tracking-wide text-gray-100",children:o})})]})},pe=()=>{const o=Z(),t=A(),s=Q(),{loggedInUser:n}=W(),[a,c]=l.useState(null),[u,m]=l.useState(!1),[f,i]=l.useState(T),g=f.state==="succeeded"&&a&&!u,r=f.state==="loading",{id:b}=o,d=n&&n.id===b,{register:w,handleSubmit:x,formState:{errors:N}}=te({});async function U(){try{i(y=>({...y,state:"loading"}));const p=await B.getUserStats();c(p),i(y=>({...y,state:"succeeded"}))}catch(p){const y=H(p);i(S=>({...S,state:"failed",error:y}))}}l.useEffect(()=>{!d||a||U()},[d,a]);function L(){s(J()),t("/home")}function z(){m(p=>!p)}async function R({language:p,level:y}){try{i(M=>({...M,state:"loading"})),await B.removeUserCorrectAnswers({language:p,level:y});const S=await B.getUserStats();c(S),i(M=>({...M,state:"succeeded"}))}catch(S){const M=H(S);i(F=>({...F,state:"failed",error:M}))}}function $(p){n&&(s(K({...n,...p})),m(!1))}return h("main",{className:"flex min-h-[250px] w-screen flex-col items-center overflow-hidden",children:[!d&&e(C,{className:"mt-52"}),d&&h("div",{className:"mt-10 flex w-full flex-col items-center gap-6 md:w-3/5",children:[h(V,{className:"flex w-full flex-col gap-4",children:[e("h1",{className:"text-4xl font-semibold tracking-wider",children:n.username}),h("div",{className:"flex items-center gap-3 self-start",children:[e(k,{onClickFn:L,className:"text-md transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",children:"logout"}),e(k,{onClickFn:z,className:"text-md transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",children:u?"stats":"edit"})]})]}),u&&h("form",{onSubmit:x($),className:"mt-10 flex flex-col items-center gap-4 rounded-xl bg-gray-600 p-6",children:[e("input",{...w("username",{required:"Username is required"}),placeholder:"Username",className:"text-md w-64 transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",defaultValue:n.username||""}),N.username&&e(j,{msg:N.username.message}),e("input",{...w("email",{required:"Email is required",pattern:{value:/\S+@\S+\.\S+/,message:"Entered value does not match email format"}}),placeholder:"Email",className:"text-md w-64 transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",defaultValue:n.email||""}),N.email&&e(j,{msg:N.email.message}),e(k,{type:"submit",className:"text-md mt-5 w-20 transform rounded-full bg-gray-800 p-3 font-semibold uppercase transition-all duration-300 ease-in-out hover:scale-105",children:"Save"})]}),h("ul",{className:X("flex w-full flex-wrap gap-4 self-start",{"justify-center":r}),children:[r&&e(C,{className:"mt-10 self-center"}),g&&e(D,{children:Object.entries(a.answersCount).map(([p,y])=>e(le,{answerLanguage:p,answerCount:y,questionCount:a.questionsCount[p],onRestart:R},p))})]})]})]})};export{pe as default};
