import{a as j,S as A,G as I,b as M,k as R,ae as B,r as l,c as t,F as d,j as e,L as G,af as U,_ as y,ag as z,ah as D,ai as W}from"./index-00d1cdc1.js";import{M as _,c as O,B as P}from"./Button-628ce1b7.js";import{u as V}from"./index.esm-2f27f700.js";import{E as g}from"./ErrMsg-d6d11dda.js";function $(){const n=j(),o=A();function r(){const c=o.pathname.substring(0,o.pathname.lastIndexOf("/"));n(c)}return r}function H(n){return I({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}}]})(n)}const J={username:"",email:"",password:"",passwordConfirm:""},Z=()=>{const n=M(),o=$(),{queryState:r}=R(),c=r.state==="loading",[C]=B(),u=C.get("resetToken"),[s,f]=l.useState("login"),[E,b]=l.useState(!1),{register:m,handleSubmit:F,formState:{errors:i},watch:N,clearErrors:h,reset:S}=V({defaultValues:J}),v=l.useRef({});v.current=N("password","");function T(a){switch(s){case"login":{const{username:x,password:w}=a;n(D(x,w));break}case"signup":{n(z(a));break}case"resetPassword":{const{password:x,passwordConfirm:w}=a;if(u)return n(U({resetToken:u,password:x,passwordConfirm:w}));console.error("No reset token found"),y.error("No reset token found in the URL");break}}}function k(){switch(s){case"login":return"Login";case"signup":return"Sign up";case"resetPassword":return"Reset Password";default:return"Login"}}function L(){if(h(),s==="login")return f("signup");if(s==="signup")return f("login")}async function q(){try{const a=N("username");await W.sendResetPasswordEmail(a),b(!1),y.success("An email has been sent to you with instructions")}catch(a){console.error(a),y.error("An error occurred. Please try again later")}}const p="w-full rounded border text-gray-950 border-gray-300 px-2 text-2xl focus:border-blue-500 focus:outline-none h-16 md:h-12";return l.useEffect(()=>{if(r.state==="succeeded")return o(),()=>{S(),h()}},[S,h,r.state,o]),l.useEffect(()=>{u&&f("resetPassword")},[u]),l.useEffect(()=>{r.error==="Incorrect username or password"&&b(!0)},[r.error]),t(d,{children:[e(_,{onClickFn:o,darkMode:!0}),t("main",{className:O("h- fixed left-1/2 top-1/2 z-[1000] flex h-full min-h-min w-full max-w-[800px] -translate-x-1/2 -translate-y-1/2 flex-col items-center overflow-scroll bg-gray-50 px-3 pt-5 md:h-1/2 md:max-h-[400px] md:w-1/2 md:rounded-xl",{"justify-center":c}),children:[c&&e(G,{}),!c&&t(d,{children:[e(P,{className:"flex h-10 w-10 items-center justify-center self-end rounded-full text-center hover:bg-gray-200 hover:text-gray-700 md:!hidden",onClickFn:o,children:e(H,{className:"text-3xl"})}),e("h1",{className:"mb-6 mt-10 text-center text-6xl font-bold text-gray-700 md:mt-0 md:text-5xl",children:k()}),t("form",{onSubmit:F(T),className:"flex w-full max-w-xl flex-col items-center justify-center gap-4 rounded-lg p-3 sm:max-w-2xl md:max-w-lg",children:[s!=="resetPassword"&&t(d,{children:[e("input",{...m("username",{required:"Username is required"}),placeholder:"Username",className:p}),i.username&&e(g,{msg:i.username.message})]}),s==="signup"&&t(d,{children:[e("input",{...m("email",{required:!0,pattern:/^\S+@\S+\.\S+$/}),placeholder:"Email",className:p}),i.email&&e(g,{msg:i.email.type==="required"?"Email is required":"Email is invalid"})]}),e("input",{type:"password",...m("password",{required:!0}),placeholder:"Password",className:p}),s!=="login"&&t(d,{children:[e("input",{...m("passwordConfirm",{validate:a=>a===v.current||"The passwords do not match"}),type:"password",placeholder:"Confirm Password",className:p}),i.passwordConfirm&&e(g,{msg:i.passwordConfirm.message})]}),E&&t(P,{className:"flex items-center gap-1",onClickFn:q,children:[e("span",{className:"text-2xl text-gray-800",children:"Forgot your password?"}),e("span",{className:"text-2xl text-blue-500 hover:underline",children:"Click here to reset it"})]}),e(P,{type:"submit",className:"mt-2 rounded-full bg-gray-700 px-8 py-6 text-4xl font-medium leading-none text-white transition-all duration-300 hover:scale-105 md:px-5 md:py-3 md:text-2xl",children:k()}),s!=="resetPassword"&&t("p",{className:"mt-6 flex items-center gap-1 text-3xl text-gray-700 md:text-2xl",children:[s==="login"&&e("span",{children:"Don't have an account?"}),s==="signup"&&e("span",{children:"Already have an account?"}),e("span",{onClick:L,className:"cursor-pointer text-blue-500 hover:underline",children:s==="login"?"Sign up":"Log in"})]})]}),r.state==="failed"&&e(g,{msg:r.error})]})]})]})};export{Z as default};
